<script data-turbo-eval="false">
// Color Scheme Handler

// Initialization
var initialColorScheme = localStorage.getItem("colorScheme");
var initialThemeName = localStorage.getItem("themeName");

if (initialColorScheme == null || initialColorScheme == "") {
    localStorage.setItem("colorScheme", "auto");
    document.documentElement.setAttribute('data-bs-theme');
}
if (initialThemeName == null || initialThemeName == "") {
    localStorage.setItem("themeName", "default");
}

if (urlParamValues.theme != undefined){
    urlParamValues.theme = urlParamValues.theme.replace(/[ .]/g, "").split("-"); // This makes dash as delimiter to theme name and color scheme, and removes illegal characters to the theme name.
    initialColorScheme = urlParamValues.theme[1];
    initialThemeName = urlParamValues.theme[0];
}

document.documentElement.setAttribute('data-theme-name', initialThemeName);

document.addEventListener(["turbo:load"], (event) => {
    var themeTogglerBtn = document.querySelector(`[data-theme-toggler-value="${initialThemeName}-${initialColorScheme}"]`);
    var themeTogglerIcon = themeTogglerBtn.children[0].classList;
    var activeThemeIcon = document.getElementById("theme-icon-active");

    document.querySelectorAll('[data-theme-toggler-value]').forEach(element => {
      element.classList.remove('active')
      element.setAttribute('aria-pressed', 'false')
    })

    activeThemeIcon.className = "";
    themeTogglerIcon.forEach(function(cls) {
        activeThemeIcon.classList.add(cls);
    });

    themeTogglerBtn.classList.toggle("active");
    themeTogglerBtn.setAttribute('aria-pressed', 'true');
});


const colorSchemeQuery = window.matchMedia('(prefers-color-scheme: dark)');
const handleAutoColorSchemeChange = (event) => {
    if (event.matches) {
			document.documentElement.setAttribute('data-bs-theme', "dark");

    } else {
			document.documentElement.setAttribute('data-bs-theme', "light");
    }
};

if (initialColorScheme === 'auto') {
    handleAutoColorSchemeChange(colorSchemeQuery);
    colorSchemeQuery.addEventListener('change', handleAutoColorSchemeChange);
} else {
    document.documentElement.setAttribute('data-bs-theme', initialColorScheme);
}

// Color Scheme Switcher 
function setTheme(colorScheme, themeName, iconClass) {

    if (themeName == undefined){
      themeName = "default"
    }

    if (themeName !== "default" && iconClass !== null) {
        //document.getElementById("themeSwitcherActiveIcon").className(iconClass);
    }

    document.querySelectorAll('[data-theme-toggler-value]').forEach(element => {
      element.classList.remove('active')
      element.setAttribute('aria-pressed', 'false')
    })
    
    var themeTogglerBtn = document.querySelector(`[data-theme-toggler-value="${themeName}-${colorScheme}"]`);
    var themeTogglerIcon = themeTogglerBtn.children[0].classList;
    var activeThemeIcon = document.getElementById("theme-icon-active");

    activeThemeIcon.className = "";
    themeTogglerIcon.forEach(function(cls) {
        activeThemeIcon.classList.add(cls);
    });

    themeTogglerBtn.classList.toggle("active");
    themeTogglerBtn.setAttribute('aria-pressed', 'true');

    if (colorScheme === "auto") {
        handleAutoColorSchemeChange(colorSchemeQuery);
        colorSchemeQuery.addEventListener('change', handleAutoColorSchemeChange);

        localStorage.setItem("colorScheme", "auto");
    } else {
        colorSchemeQuery.removeEventListener('change', handleAutoColorSchemeChange);

        localStorage.setItem("colorScheme", colorScheme);
        document.documentElement.setAttribute('data-bs-theme', colorScheme);
    }

    if (themeName !== undefined && themeName !== null) {
        localStorage.setItem("themeName", themeName);
        document.documentElement.setAttribute('data-theme-name', themeName);
    }
}
</script>